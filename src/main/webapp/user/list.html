<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>List</title>
        <link rel="stylesheet" type="text/css" href="/restful/css/style.css"/>
        <script type="text/javascript" src="/restful/js/restful.js"></script>
        <script type="text/javascript">
            // window.onload
            window.onload = function() {
                var url = location.href;
                var params = "";
                
            	if (url.indexOf('?') > 0) {
                    params = (url.substring(url.indexOf('?'), url.length));
            	}
            	
                var url = "/restful/api/user/list" + params;
                
                ajaxCall('GET', url, null, null, function(data) {
                        var status = data.status;
                        if (status == 'OK') {
                            success(data);
                        }
                    }, function(data) {
                        fail(data);
                    }
                );
            };
    
            // Success function
            function success(data) {
            	for (str in data.response) {
                    if (data.response[str] != null && data.response[str] != 0) {
                    	
                        if (str == "query") {
                        	
                            var url = location.href;
                            
                            if (url.indexOf('?') > 0) {
                                url = url.substring(0, url.indexOf('?'));
                            }
                            
                            var query = data.response.query;
                                                        
                            var pn = query.paging.pn;
                            var maxResults = query.paging.maxResults;
                            var totalResults = query.paging.totalResults;
                            var screenResults = 5;
                            
                            if (totalResults > 0) {
                                var paging = "";
                            	
                            	var current = parseInt((pn - 1) / screenResults) + 1;
                            	var start = (current - 1) * screenResults + 1;
                            	var end = (start + screenResults) - 1;
                                var total = parseInt(totalResults / maxResults);
                            	
                            	if (totalResults % maxResults > 0) {
                            		total = total + 1;
                            	}
                            	if (end > total) {
                            		end = total;
                            	}
                            	
                            	if (start > 1) {
                            		paging += "<a href=\""+ url + "?pn=1\"> << </a>"; 
                            	} else {
                            		paging += " << ";
                            	}
                            	if (start > screenResults) {
                            		var prev = start - 1;
                                    paging += "<a href=\"" + url + "?pn=" + prev + "\"> < </a>";
                            	} else {
                                    paging += " < ";
                            	}
                            	
                            	for (var i = start ; i <= end ; i++) {
                            		if (i == pn) {
                            			paging += "<b> " + i + " </b>";
                            		} else {
                            			paging += "<a href=\"" + url + "?pn=" + i + "\"> " + i + " </a>";
                            		}
                            	}
                            	
                            	if (end < total) {
                                    var next = end + 1;
                                    paging += "<a href=\"" + url + "?pn=" + next + "\"> > </a>";
                            	} else {
                                    paging += " > ";
                            	}
                            	if (end < total) {
                                    paging += "<a href=\"" + url + "?pn=" + total + "\"> >> </a>";
                            	} else {
                                    paging += " >> ";
                            	}
                            	
                            	document.getElementById('paging').innerHTML = paging;
                            }
                            
                        } else if (str == "object") {
                        	
                            var html = "";
                            
                            html += "<table>";
                            html += "<tr align=\"center\">";
                            html += "<td>Idx</td>";
                            html += "<td>UserId</td>";
                            html += "<td>UserName</td>";
                            html += "<td>Role</td>";
                            html += "</tr>";
                            
                            var object = data.response.object;
                            
                            for (var i = 0 ; i < object.length ; i++) {
                            	var user = object[i];
                            	html += "<tr>";
                                html += "<td>" + user.idx + "</td>"
                                html += "<td>" + user.name + "</td>"
                                html += "<td>" + user.username + "</td>" 
                                html += "<td>" + user.role + "</td>"
                                html += "</tr>";
                            }
                            
                            html += "</table>";
                            
                            document.getElementById('user').innerHTML = html;
                        
                        }
                        
                    }
            	}
            }

            // Fail function
            function fail(data) {
                var html = data.response;
                document.getElementById('user').innerHTML = html;
            }
            
            function search() {
                var url = location.href;
                
                if (url.indexOf('?') > 0) {
                    url = url.substring(0, url.indexOf('?'));
                }
                
                var q =  document.getElementById('search').value;
                
                if (q) {
                	location.href = url + "?q=" + q;
                }
            }
        </script>
    </head>
    <body>
        <p>List</p>
        <table style="width: 180px;">
            <tr>
                <td><div id="user"></div></td>
            </tr>
            <tr>
                <td align="center">
                    <input type="text" name="search" id="search" tabindex="1" size="10" placeholder=" Search">
                    <button type="submit" onClick="search()"><span>Search</span></button>
                </td>
            </tr>
            <tr>
                <td align="center"><div id="paging"></div></td>
            </tr>
        </table>
    </body>
</html>